# /pm:task:update - Update task fields

更新任务的任意字段。支持两种更新方式：直接指定内容 或 基于上下文智能生成。

## 用法

### 方式 1：直接指定更新内容

```bash
# 更新描述
/pm:task:update 123 --description "新的描述"

# 更新优先级
/pm:task:update 123 --priority urgent

# 更新标签
/pm:task:update 123 --tags "bug,critical,sync"

# 更新标题
/pm:task:update 123 --title "新标题"

# 添加备注
/pm:task:update 123 --notes "额外的备注信息"

# 更新多个字段
/pm:task:update 123 --title "新标题" --priority high --tags "bug,critical"
```

### 方式 2：基于上下文的智能更新 ⭐

当用户说"更新任务"、"完善任务"、"按照建议更新"时，AI 应该：

1. **分析上下文**：回顾最近对话中的质量检查报告、改进建议
2. **智能生成内容**：根据建议生成完整的任务描述
3. **执行更新**：调用 pm task update 命令
4. **确认结果**：显示更新内容供用户确认

```bash
# 示例：用户刚完成质量检查，想按建议完善任务
用户："更新任务 5，补充完整的 Bug 信息"

AI 分析：
  - 回顾质量检查报告中的改进建议
  - 识别缺失的信息（复现步骤、错误日志、影响范围）
  - 参考项目模板（.pm/task-rules.yaml）

AI 生成：
  **Bug 描述**：...
  **复现步骤**：...
  **错误信息**：...
  **影响范围**：...
  **验收标准**：...

AI 执行：
  pm task update 5 --description "生成的完整内容"
```

## 参数

- `--title` - 新标题
- `--description` - 新描述
- `--status` - 新状态（通常用 start/pause/done 命令修改）
- `--priority` - 新优先级（urgent/high/medium/low）
- `--tags` - 新标签（逗号分隔）
- `--notes` - 添加备注

## AI 会做什么

### 方式 1（直接指定）：
1. 运行 `pm task update <id> --<field> "<value>"`
2. 更新指定字段
3. 保存到 `.project-log/tasks/<id>.md`
4. 显示更新后的任务信息

### 方式 2（智能更新）：
1. **识别意图**：用户想基于上下文完善任务
2. **分析上下文**：
   - 回顾对话历史（质量检查、改进建议）
   - 读取当前任务内容
   - 理解缺失的信息
3. **智能生成**：
   - 根据项目规则和模板生成完整内容
   - 填充缺失的必需信息
   - 添加验收标准和测试要求
4. **执行更新**：`pm task update <id> --description "生成内容"`
5. **确认结果**：显示更新后的内容

## 输出示例

### 方式 1 示例：

```
📝 Updated task #123

Changes:
  Priority: medium → urgent
  Tags: bug → bug, critical
  Notes: 发现新问题

Updated task:
  #123 [urgent] 修复邮件同步bug
  Status: in-progress
  Tags: bug, critical
```

### 方式 2 示例：

```
🔍 分析上下文...

基于质量检查报告，我将为任务 #5 补充以下信息：
- 完整的复现步骤
- 详细的错误日志
- 影响范围分析
- 明确的验收标准

生成的完整描述：

**Bug 描述**：
账户 100999751@qq.com 同步操作失败

**复现步骤**：
1. 前置条件：登录系统，账户 100999751@qq.com 已添加
2. 打开首页
3. 点击该账户的重试按钮
4. 观察：显示错误

**错误信息**：
- API: POST /mail/accounts/3739139e-a5ca-46cd-8e9b-653ec274273c/folders/sync
- [需要补充完整错误响应]

**验收标准**：
- [ ] Bug 修复验证：账户同步成功
- [ ] E2E 测试覆盖同步重试场景
- [ ] 测试使用 WebSocket 监听（不用固定延时）
- [ ] 测试后清理数据

是否执行更新？[y/N]
```

## 自然语言快捷方式

### 方式 1：直接指定内容

**示例**：
- 用户："给任务 123 添加描述：新的描述"
  → AI 执行：`pm task update 123 --description "新的描述"`

- 用户："任务 123 优先级改成 urgent"
  → AI 执行：`pm task update 123 --priority urgent`

- 用户："任务 123 加标签 critical,sync"
  → AI 执行：`pm task update 123 --tags "critical,sync"`

**识别模式**：
- "给任务 X 添加描述" / "任务 X 加描述" → 更新描述
- "任务 X 优先级改成 Y" / "任务 X 改优先级" → 更新优先级
- "任务 X 加标签" / "任务 X 添加标签" → 更新标签
- "任务 X 改名" / "任务 X 重命名" → 更新标题

### 方式 2：基于上下文智能更新 ⭐

**示例**：
- 用户："更新任务 5，补充完整的 Bug 信息和验收标准"
  → AI 分析上下文（质量检查报告）
  → AI 生成完整描述
  → AI 执行：`pm task update 5 --description "生成的完整内容"`

- 用户："按照建议完善任务 5"
  → AI 回顾改进建议
  → AI 智能生成内容
  → AI 执行更新

- 用户："完善任务 3"
  → AI 分析任务当前状态
  → AI 补充缺失信息
  → AI 执行更新

**识别模式**：
- "更新任务 X" / "完善任务 X" → 智能分析并更新
- "按照建议更新任务 X" / "改进任务 X" → 根据建议更新
- "补充任务 X 的信息" → 填充缺失信息

**重要**：
- 智能更新需要有足够的上下文（如刚完成质量检查）
- AI 会先生成内容并展示，让用户确认后再执行
- 如果上下文不足，AI 会询问具体要更新什么

## 智能更新的典型场景

### 场景 1：质量检查后完善任务

```
1. 用户："/pm:task:check 5"
   → AI 执行质量检查，发现任务评分 27/60，给出改进建议

2. 用户："更新任务 5，补充缺失信息"
   → AI 基于质量检查报告智能生成完整描述
   → AI 执行更新
   → AI 再次检查质量，确认改进
```

### 场景 2：根据讨论完善任务

```
1. 用户和 AI 讨论某个 Bug 的细节

2. 用户："完善任务 10"
   → AI 回顾对话中提到的细节
   → AI 生成包含讨论内容的完整描述
   → AI 执行更新
```

### 场景 3：标题规范化

```
1. 用户创建任务时标题不规范

2. 用户："改进任务 8 的标题"
   → AI 分析当前标题
   → AI 生成符合项目规范的标题（[类型] 具体目标）
   → AI 执行更新
```

## 相关命令

- `/pm:task:show` - 查看任务详情
- `/pm:task:check` - 检查任务质量
- `/pm:task:list` - 列出所有任务
