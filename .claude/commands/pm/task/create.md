# /pm:task:create - Create a new task

创建一个新任务。

## 用法

```bash
# 创建任务（最简）
/pm:task:create "修复邮件同步bug"

# 完整参数
/pm:task:create "修复邮件同步bug" --description "用户报告邮件同步超时" --priority high --tags "bug,email"
```

## 参数

- `title` (必需) - 任务标题
- `--description` - 任务详细描述
- `--priority` - 优先级：low, medium (默认), high, urgent
- `--tags` - 标签，逗号分隔

## AI 会做什么

1. 运行 `pm task create "<title>" [options]`
2. 创建任务并分配 ID
3. 保存到 `.project-log/tasks/<id>.json`
4. 显示任务信息
5. **⭐ 自动执行质量检查**（推荐）或建议用户检查
   - **必须读取项目规则**：`.task-context.md` 和 `.pm/task-rules.yaml`
   - 根据 TDD 原则和项目规范检查任务
6. 根据质量检查结果给出建议

## 质量检查工作流（V3.7+）

**重要**：创建任务后应该立即检查质量，确保任务描述完备、目的清晰，**并符合 TDD 和项目规范**。

### 自动检查（推荐）

AI 应该在创建任务后立即执行质量检查：

```
1. 创建任务成功
   ↓
2. 自动读取任务信息
   ↓
3. 读取项目规则（重要！）
   - `.task-context.md` - 最新关注点和临时规则（含 TDD 要求）
   - `.pm/task-rules.yaml` - 稳定的项目规范
   ↓
4. 执行质量检查（读取 task-quality-gate.md）
   - 检查是否包含测试设计（TDD 要求）
   - 检查是否符合项目规范
   ↓
5. 根据评分给出建议：
   - 🟢 优秀（50-60）：建议直接启动
   - 🟡 良好（40-49）：建议完善后启动
   - 🟠 及格（30-39）：需要改进
   - 🔴 不合格（<30）：强烈建议完善
```

### 工作流程

```
# 场景 1：简单创建（缺少描述）
用户：创建任务：修复bug
  ↓
AI：创建任务 #5
  ↓
AI：自动检查质量...
  ↓
评分：25/60 - 🔴 不合格
  ↓
AI：建议补充描述、优先级、验收标准

# 场景 2：完整创建
用户：创建任务 + 详细描述
  ↓
AI：创建任务 #5
  ↓
AI：自动检查质量...
  ↓
评分：52/60 - 🟢 优秀
  ↓
AI：建议直接启动任务
```

## 输出示例

### 示例 1：完整任务（自动检查通过）

```
✅ 创建任务成功

📋 任务 #123: [Bug] 修复邮件同步超时
   优先级: high
   标签: bug, email, sync
   状态: todo

🔍 质量检查...

📊 质量评分: 52/60 - 🟢 优秀
   ✅ 基础完整性: 9/10
   ✅ 目的清晰度: 9/10
   ✅ 类型匹配度: 9/10
   ✅ 验收标准: 8/10
   ✅ 项目规则: 9/10
   ✅ 最新关注: 8/10

✅ 任务质量很好，可以开始工作！

💡 建议：
   /pm:task:start 123  - 启动任务（推荐）
   /pm:task:show 123   - 查看完整详情
```

### 示例 2：简单任务（需要完善）

```
✅ 创建任务成功

📋 任务 #124: 修复bug
   优先级: medium
   标签: 无
   状态: todo

🔍 质量检查...

📊 质量评分: 28/60 - 🔴 不合格
   ⚠️ 基础完整性: 5/10 - 标题太笼统
   ❌ 目的清晰度: 2/10 - 缺少背景和目标
   ❌ 类型匹配度: 3/10 - 缺少必需信息
   ❌ 验收标准: 0/10 - 没有验收标准
   ⚠️ 项目规则: 8/10
   ✅ 最新关注: 10/10

⚠️ 任务质量不足，建议完善后再启动

💡 必需改进：
   1. 具体化标题：改为 "[Bug] 修复XX功能的XX问题"
   2. 添加描述：说明问题现象、影响范围
   3. 添加验收标准：如何验证修复成功

操作：
   /pm:task:update 124 --description "详细描述..."  - 补充描述
   /pm:task:update 124 --title "更具体的标题"       - 改进标题
   /pm:task:check 124                              - 再次检查

   或参考模板：
   cat .pm/task-rules.yaml | grep -A 20 "bug_fix"
```

## 创建时的最佳实践

### ✅ 推荐的创建方式（遵循 TDD）

```bash
# 方式 1：使用模板创建（包含 TDD 流程）
/pm:task:create "[Bug] 修复大量邮件同步超时" \
  --description "
**Bug 描述**：1000+ 封邮件时同步超时
**复现步骤**：1. 导入 1500 封邮件 2. 触发同步
**影响范围**：大邮箱用户（约 15%）

**🔴 回归测试设计（TDD - 先写测试）**：
\`\`\`typescript
describe('Bug修复: 大量邮件同步超时', () => {
  it('应该在 120 秒内完成 2000 封邮件同步', () => {
    // 测试代码（当前应该失败）
  });
});
\`\`\`

**开发流程（TDD）**：
1. ✅ 编写回归测试（失败 - Red）
2. ✅ 修复代码使测试通过（Green）
3. ✅ 重构优化（Refactor）

**验收标准**：
- [ ] 🔴 回归测试已编写且失败（Red）
- [ ] 🟢 Bug 修复后测试通过（Green）
- [ ] 🔵 代码已重构优化（Refactor）
- [ ] 2000 封邮件同步成功
- [ ] 同步时间 < 120s
  " \
  --priority high \
  --tags "bug,sync,email"

# 创建后会自动检查，评分预计：55+/60 🟢
# 包含 TDD 流程会获得更高评分
```

### ❌ 不推荐的创建方式

```bash
# 太简单，会导致低分
/pm:task:create "fix bug"

# 创建后评分预计：< 30/60 🔴
# 需要大量补充信息
```

## 自然语言快捷方式

用户可以用自然语言描述意图，AI 会自动创建任务：

**示例**：
- 用户："创建任务：修复邮件同步bug"
  → AI 执行：`pm task create "修复邮件同步bug"`

- 用户："新建一个 urgent 任务：紧急修复登录"
  → AI 执行：`pm task create "紧急修复登录" --priority urgent`

- 用户："创建 bug 修复任务：xxx"
  → AI 执行：`pm task create "xxx" --tags "bug"`

**识别模式**：
- "创建任务" / "新建任务" / "添加任务" → `pm task create`
- "urgent" / "紧急" → `--priority urgent`
- "high" / "高优先级" → `--priority high`
- "bug" → `--tags "bug"`

## 相关命令

- `/pm:task:list` - 列出所有任务
- `/pm:task:start` - 启动任务
- `/pm:task:show` - 查看任务详情
